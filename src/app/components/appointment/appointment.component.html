<section id="termine" class="appointment-section">
  <div class="section-heading">
    <span class="eyebrow">Termin vereinbaren</span>
    <h2>Dein Termin im City-Style Salon</h2>
    <p>
      Service, Stylist:in und Termin wählen – wir melden uns blitzschnell zur Bestätigung.
      Kurzfristig erreichbar unter <a href="tel:+49911421966">0911 421966</a>.
    </p>
  </div>

  <div class="appointment-wrapper">
    <form [formGroup]="appointmentForm" (ngSubmit)="submit()">
      <div class="form-grid">
        <label>
          <span>Vor- und Nachname</span>
          <input type="text" formControlName="name" placeholder="Dein Vor- und Nachname" />
          <small class="error" *ngIf="appointmentForm.get('name')?.touched && appointmentForm.get('name')?.invalid">
            Bitte gib Deinen Namen ein.
          </small>
        </label>

        <label>
          <span>Telefon</span>
          <input type="tel" formControlName="phone" placeholder="+49 170 1234567" />
          <small class="error" *ngIf="appointmentForm.get('phone')?.touched && appointmentForm.get('phone')?.invalid">
            Bitte gib eine gültige Telefonnummer ein.
          </small>
        </label>

        <label>
          <span>Service</span>
          <select formControlName="service">
            <option value="" disabled>Bitte auswählen</option>
            <option *ngFor="let service of services" [value]="service.value">
              {{ service.label }}
            </option>
          </select>
          <small class="error" *ngIf="appointmentForm.get('service')?.touched && appointmentForm.get('service')?.invalid">
            Bitte wähle einen Service.
          </small>
        </label>

        <label>
          <span>Stylist:in</span>
          <select formControlName="stylist">
            <option value="" disabled>Bitte auswählen</option>
            <option *ngFor="let stylist of stylists" [value]="stylist.value">
              {{ stylist.label }}
            </option>
          </select>
          <small class="error" *ngIf="appointmentForm.get('stylist')?.touched && appointmentForm.get('stylist')?.invalid">
            Bitte wähle eine:n Stylist:in.
          </small>
        </label>

        <label>
          <span>Datum</span>
          <input type="date" formControlName="date" />
          <small class="error" *ngIf="appointmentForm.get('date')?.touched && appointmentForm.get('date')?.invalid">
            <ng-container *ngIf="appointmentForm.get('date')?.errors?.['disallowedDay']; else requiredDate">
              Termine nur Montag bis Donnerstag buchbar.
            </ng-container>
            <ng-template #requiredDate>Bitte wähle ein Datum.</ng-template>
          </small>
        </label>

        <label class="time-display">
          <span>Uhrzeit</span>
          <div class="time-value" [class.empty]="!selectedTime">
            {{ selectedTime ?? 'Bitte rechts eine Uhrzeit anklicken' }}
          </div>
          <input type="hidden" formControlName="time" />
          <small class="error" *ngIf="appointmentForm.get('time')?.touched && appointmentForm.get('time')?.invalid">
            Bitte wähle eine Uhrzeit.
          </small>
        </label>
      </div>

      <label class="notes">
        <span>Styling-Notes (optional)</span>
        <textarea formControlName="notes" rows="4" placeholder="Moodboard, Haarstruktur oder Wünsche …"></textarea>
      </label>

      <button type="submit" class="submit" [disabled]="isSubmitting">
        {{ isSubmitting ? 'Wird gesendet …' : 'Termin sichern' }}
      </button>

      <p class="confirmation" *ngIf="submitSuccess">
        Danke! Termin erfolgreich reserviert.
      </p>
      <p class="error global" *ngIf="submitError">{{ submitError }}</p>
    </form>

    <aside class="info-card">
      <h3>Wähle Deine Uhrzeit</h3>
      <div class="time-grid">
        <button
          type="button"
          class="time-slot"
          *ngFor="let slot of timeSlots"
          [class.selected]="selectedTime === slot"
          [attr.aria-pressed]="selectedTime === slot"
          (click)="selectTime(slot)"
        >
          {{ slot }}
        </button>
      </div>
    </aside>
  </div>
</section>
